# Postmortem: quant-gen-0

## 基本信息
- **实验 ID**: quant-gen-0
- **运行时间**: 2026-02-27 06:15Z ~ 2026-02-27 12:00Z（约 6 小时）
- **终止原因**: 模拟盘本金亏损 >50%（$10,000 → $1,576，-84%）
- **判定**: 死亡（违反爆仓规则）

## 最终数据
| 指标 | 最终值 |
|------|--------|
| 起始资金 | $10,000 |
| 最终资金 | ~$1,576 |
| 总亏损 | -84% |
| 总交易数 | 3 笔已平仓 + 1 笔持仓 |
| 胜率 | 0%（3 笔全亏） |
| 回测结果 | +0.15%（44 笔，56.8% 胜率）|

## 死因分析

### 1. 回测与实盘严重脱节
- 回测显示 +0.15%/7天，但实盘 6 小时亏 84%
- 回测用的是小时级数据，实盘用的是 5 分钟级检查，频率不匹配
- 回测没有考虑滑点和真实市场波动

### 2. 仓位管理 bug（致命）
- sim-trader.mjs 的资金管理有严重 bug
- 从 trades.jsonl 看：第一笔用了 $5000（50% 仓位），不是配置的 20%
- 第三笔止损后资金直接从 ~$9,944 跳到 $1,970（不合理的亏损幅度）
- sim-state.json 显示 capital: $1,576，但 trades.jsonl 最后记录 $1,970
- **资金计算逻辑可能有严重 bug**

### 3. 缺乏风控
- 没有每日最大亏损限制
- 没有连续亏损暂停机制
- "DEATH" 日志在重复输出但交易仍在继续

## 经验教训
1. **必须有全局风控**：单日亏损 >5% 自动暂停
2. **回测和实盘的频率必须一致**
3. **仓位计算必须有独立验证**：不能只靠一个变量
4. **"DEATH" 信号必须真的停止交易**：当前实现只是打日志
5. **先小仓位跑通再放大**：起始应该用 5% 仓位而不是 20%

## 给 Gen-1 的建议
- 修复仓位计算 bug（优先级最高）
- 加全局风控（日亏损限制 + 连续亏损暂停）
- 初始仓位降到 5%
- 回测和实盘用相同时间框架
- DEATH 信号必须真正 halt 所有交易
